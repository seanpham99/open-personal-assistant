# Open Personal Assistant MVP Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a functional Daemon-CLI bridge with encrypted SQLite storage and a basic Supervisor agent.

**Architecture:** A FastAPI daemon managing an encrypted SQLite database and a Typer-based CLI for sending commands. Includes a basic Pydantic-based agent structure.

**Tech Stack:** Python 3.12, uv, FastAPI, Typer, Pydantic, SQLCipher (via `sqlcipher3`).

---

### Task 1: Project Initialization with `uv`

**Files:**
- Create: `pyproject.toml`
- Create: `.python-version`

**Step 1: Initialize project**

Run: `uv init --app`

**Step 2: Add core dependencies**

Run: `uv add fastapi uvicorn typer httpx pydantic pydantic-settings sqlcipher3 cryptography ruff mypy pytest`

**Step 3: Commit**

```bash
git add .
git commit -m "chore: initialize project with uv and dependencies"
```

---

### Task 2: Core Data Models & Vault

**Files:**
- Create: `src/assistant/models.py`
- Test: `tests/test_models.py`

**Step 1: Write model tests**

```python
from assistant.models import SecretVault
def test_vault_encryption():
    vault = SecretVault(key="test-key")
    encrypted = vault.encrypt("my-secret")
    assert vault.decrypt(encrypted) == "my-secret"
```

**Step 2: Implement Pydantic models**

```python
from pydantic import BaseModel
from cryptography.fernet import Fernet

class SecretVault(BaseModel):
    key: str
    def encrypt(self, value: str) -> str:
        return Fernet(self.key.encode()).encrypt(value.encode()).decode()
    def decrypt(self, value: str) -> str:
        return Fernet(self.key.encode()).decrypt(value.encode()).decode()
```

**Step 3: Run tests**

Run: `pytest tests/test_models.py`

**Step 4: Commit**

```bash
git add src/assistant/models.py tests/test_models.py
git commit -m "feat: add core models and vault logic"
```

---

### Task 3: Daemon (FastAPI) Setup

**Files:**
- Create: `src/assistant/daemon.py`
- Test: `tests/test_daemon.py`

**Step 1: Write health check test**

```python
from fastapi.testclient import TestClient
from assistant.daemon import app
client = TestClient(app)
def test_read_main():
    response = client.get("/health")
    assert response.status_code == 200
```

**Step 2: Implement FastAPI app**

```python
from fastapi import FastAPI
app = FastAPI()
@app.get("/health")
async def health():
    return {"status": "ok"}
```

**Step 3: Run tests**

Run: `pytest tests/test_daemon.py`

**Step 4: Commit**

```bash
git add src/assistant/daemon.py tests/test_daemon.py
git commit -m "feat: implement basic daemon with health check"
```

---

### Task 4: CLI (Typer) Setup

**Files:**
- Create: `src/assistant/cli.py`

**Step 1: Implement basic CLI**

```python
import typer
import httpx

app = typer.Typer()

@app.command()
def status():
    try:
        r = httpx.get("http://localhost:8000/health")
        typer.echo(f"Daemon Status: {r.json()['status']}")
    except Exception:
        typer.echo("Daemon is not running.")

if __name__ == "__main__":
    app()
```

**Step 2: Commit**

```bash
git add src/assistant/cli.py
git commit -m "feat: add basic CLI to check daemon status"
```
